<div class="flex min-h-screen flex-col bg-slate-50 text-slate-800">
  <app-header></app-header>

  <main class="flex-1">
    <div class="mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
      <!-- Título + buscador local -->
      <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
        <h1 class="text-3xl font-bold text-slate-900">
          {{ titleMap[category()] }} en {{ city }}
        </h1>

        <div class="relative w-full sm:w-80">
          <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
            <svg class="h-5 w-5 text-slate-400" viewBox="0 0 256 256" fill="currentColor">
              <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
            </svg>
          </div>
          <input
            #qbox
            type="search"
            placeholder="Buscar en {{ titleMap[category()] }}"
            class="w-full rounded-xl border-slate-300 bg-white py-2.5 pl-10 pr-3 text-sm placeholder:text-slate-400
                   focus:border-sky-600 focus:ring-sky-600"
            (keyup.enter)="onLocalSearch(qbox.value)" />
        </div>
      </div>

      <!-- Filtros -->
      <div class="mb-4 flex flex-wrap items-center gap-3">
        <!-- País -->
        <label class="inline-flex items-center">
          <span class="mr-2 text-sm text-slate-600">País</span>
          <div class="relative">
            <select
              class="appearance-none rounded-full bg-sky-600/10 px-4 py-2 text-sm font-medium text-sky-700
                     hover:bg-sky-600/20 focus:outline-none"
              [ngModel]="selectedCountry()"
              (ngModelChange)="onCountryChange($event)">
              <option [ngValue]="''">Todos</option>
              <option *ngFor="let c of countries()" [ngValue]="c">{{ c }}</option>
            </select>
            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sky-700">▾</span>
          </div>
        </label>

        <!-- Región -->
        <label class="inline-flex items-center">
          <span class="mr-2 text-sm text-slate-600">Región</span>
          <div class="relative">
            <select
              class="appearance-none rounded-full bg-sky-600/10 px-4 py-2 text-sm font-medium text-sky-700
                     hover:bg-sky-600/20 focus:outline-none"
              [disabled]="!regions().length"
              [ngModel]="selectedRegion()"
              (ngModelChange)="onRegionChange($event)">
              <option [ngValue]="''">Todas</option>
              <option *ngFor="let r of regions()" [ngValue]="r">{{ r }}</option>
            </select>
            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sky-700">▾</span>
          </div>
        </label>

        <!-- Comuna -->
        <label class="inline-flex items-center">
          <span class="mr-2 text-sm text-slate-600">Comuna</span>
          <div class="relative">
            <select
              class="appearance-none rounded-full bg-sky-600/10 px-4 py-2 text-sm font-medium text-sky-700
                     hover:bg-sky-600/20 focus:outline-none"
              [disabled]="!communes().length"
              [ngModel]="selectedCommune()"
              (ngModelChange)="onCommuneChange($event)">
              <option [ngValue]="''">Todas</option>
              <option *ngFor="let k of communes()" [ngValue]="k">{{ k }}</option>
            </select>
            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sky-700">▾</span>
          </div>
        </label>

        <!-- Contador -->
        <span class="ml-auto text-sm text-slate-500">
          {{ items().length }} resultados
        </span>
      </div>

      <!-- Grid de negocios -->
      <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
        <app-business-card *ngFor="let it of items()" [data]="it" />
      </div>

      <!-- Paginación -->
      <div class="mt-10 flex items-center justify-center gap-3">
        <button
          class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700
                 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50"
          (click)="onPrevPage()"
          [disabled]="pageIndex() === 0">
          ← Anterior
        </button>
        <span class="text-sm text-slate-500">
          Página {{ pageIndex() + 1 }} de {{ totalPages() }}
        </span>
        <button
          class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700
                 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50"
          (click)="onNextPage()"
          [disabled]="pageIndex() + 1 >= totalPages()">
          Siguiente →
        </button>
      </div>
    </div>
  </main>
</div>
